---
import { cn } from "@/lib/utils";
import { ArrowUpRight } from "lucide-astro";

interface Props {
  href: string;
  title: string;
  description?: string;
  class?: string;
}

const { href, title, description, class: className } = Astro.props;

// Get domain from URL
function getDomain(url: string): string {
  try {
    const urlObj = new URL(url);
    return urlObj.hostname.replace("www.", "");
  } catch {
    return url;
  }
}

// Get favicon URL using Google's favicon service
function getFaviconUrl(url: string): string {
  try {
    const urlObj = new URL(url);
    return `https://www.google.com/s2/favicons?domain=${urlObj.hostname}&sz=64`;
  } catch {
    return "";
  }
}

const domain = getDomain(href);
const faviconUrl = getFaviconUrl(href);
---

<a
  href={href}
  target="_blank"
  rel="noopener noreferrer"
  class:list={cn(
    "not-prose group my-6 flex items-center gap-4 rounded-xl border border-border p-4",
    "bg-muted/30 hover:bg-muted/60 hover:border-muted-foreground/30",
    "transition-all duration-300 ease-out",
    "no-underline! hover:no-underline! **:no-underline!",
    className
  )}
>
  {/* Favicon */}
  <div
    class="flex h-12 w-12 shrink-0 items-center justify-center rounded-lg bg-white border border-border"
  >
    {
      faviconUrl ? (
        <img src={faviconUrl} alt="" width={24} height={24} class="h-6 w-6" loading="lazy" />
      ) : (
        <ArrowUpRight size={20} class="text-muted-foreground" />
      )
    }
  </div>

  {/* Content */}
  <div class="flex-1 min-w-0">
    <div class="flex items-center gap-2">
      <span
        class="font-medium text-foreground group-hover:text-primary transition-colors truncate no-underline"
      >
        {title}
      </span>
      <ArrowUpRight
        size={16}
        class="shrink-0 text-muted-foreground group-hover:text-primary group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"
      />
    </div>
    {
      description && (
        <p class="mt-1 text-sm text-muted-foreground line-clamp-2 no-underline">{description}</p>
      )
    }
    <span class="mt-1.5 block text-xs text-muted-foreground/70 no-underline">{domain}</span>
  </div>
</a>
