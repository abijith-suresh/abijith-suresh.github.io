---
import BackLink from "@/components/BackLink.astro";
import Breadcrumb from "@/components/Breadcrumb.astro";
import TagList from "@/components/TagList.astro";
import { SITE } from "@/consts";
import Layout from "@/layouts/Layout.astro";
import { formatBlogDate } from "@/lib/utils";
import { type CollectionEntry, getCollection } from "astro:content";
import { ExternalLink, Github } from "lucide-astro";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

interface Props {
  project: CollectionEntry<"projects">;
}

const { project } = Astro.props;
const { title, description, tags, date, github, demo } = project.data;
const { Content } = await project.render();
const formattedDate = formatBlogDate(date);
---

<Layout
  title={`${title} - Projects - ${SITE.title}`}
  description={description}
  jsonLd={{ type: "article" }}
>
  <div class="w-full mx-auto flex grow flex-col gap-y-6 px-4 max-w-3xl pb-12 page-enter">
    <div class="page-enter page-enter-delay-1">
      <Breadcrumb
        items={[
          { label: "Home", href: "/", icon: "home" },
          { label: "Projects", href: "/projects", icon: "projects" },
          { label: title, icon: "project" },
        ]}
      />
    </div>

    <article class="flex flex-col gap-y-6 page-enter page-enter-delay-2">
      <header class="flex flex-col gap-y-4">
        <h1 class="text-3xl sm:text-4xl font-semibold text-foreground">{title}</h1>

        <div class="flex flex-wrap items-center gap-x-2 gap-y-1 text-sm text-muted-foreground">
          <time datetime={date.toISOString()}>{formattedDate}</time>
        </div>

        <p class="text-lg text-muted-foreground max-w-2xl">{description}</p>

        {
          (github || demo) && (
            <div class="flex flex-wrap gap-3">
              {github && (
                <a
                  href={github}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium border border-border rounded-lg hover:bg-accent transition-colors"
                >
                  <Github size={16} />
                  View Source
                </a>
              )}
              {demo && (
                <a
                  href={demo}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium bg-foreground text-background rounded-lg hover:opacity-90 transition-opacity"
                >
                  <ExternalLink size={16} />
                  Live Demo
                </a>
              )}
            </div>
          )
        }

        <div>
          <TagList tags={tags} />
        </div>
      </header>

      <article class="prose max-w-none">
        <Content />
      </article>
    </article>

    <div class="page-enter page-enter-delay-2">
      <BackLink href="/projects" label="Back to Projects" />
    </div>
  </div>
</Layout>
